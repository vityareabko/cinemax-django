
{% extends "base.html" %}
{% load static i18n %}
{% block title %}{% trans "бронювання" %}{% endblock %}

{% block stylesheet %} 

    <link rel="stylesheet" href="{% static 'css/reservations.css' %}">
    
{% endblock %}

{% block content %}
            <table class="body-wrap  ">
                <tbody>
                    <tr>
                        <td></td>
                        <td class="container" width="600">
                            <div class="content shadow">
                                <table class="main" width="100%" cellpadding="0" cellspacing="0">
                                    <tbody>
                                        <tr>
                                            <td class="content-wrap  aligncenter">
                                                <table width="100%" cellpadding="0" cellspacing="0">
                                                    <tbody>
                                                        <tr>
                                                            <td class="content-block">
                                                                <h1>Cinemax</h1>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td class="content-block">
                                                                <table class="invoice">
                                                                    <tbody>
                                                                        <tr>
                                                                            <td>
                                                                                <table class="invoice-items" cellpadding="0" cellspacing="0">
                                                                                    <tbody>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Фільм" %}: </td>
                                                                                            <td class=""> {{ movie.name }} </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Дата показу" %}: </td>
                                                                                            <td class=""> {{ session.session_date }}  </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Час сеансу" %}: </td>
                                                                                            <td class=""> {{ time_sessions.time }}  </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "зал" %} №: </td>
                                                                                            <td class=""> {{ num_hall }} </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Ряд" %}: </td>
                                                                                            <td class=""> {{ place.row_number }}  </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Місце в залі" %}: </td>
                                                                                            <td class=""> {{ place.place_number }}  </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Ціна сеансу" %}: </td>
                                                                                            <td class=""> {{ session.price_session }} ₴  </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            <td class="text-right pr-2">{% trans "Ціна за сектор" %}: </td>
                                                                                            <td class=""> {{ sector.price_sector }} ₴ </td>
                                                                                        </tr>
                                                                                        <tr>
                                                                                            
                                                                                            <!-- <img src="{{ test }}" alt=""> -->
                                                                                           
                                                                                        </tr>
                                                                                        
                                                                                    </tbody>
                                                                                </table>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <table class="invoice-items" cellpadding="0" cellspacing="0">
                                                                                    <tbody>
                                                                                        
                                                                                        <tr>
                                                                                            <td>{% trans "Кінцева ціна" %}</td>
                                                                                            <td class="alignright"> </td>
                                                                                        </tr>
                                                                                        <tr class="total">
                                                                                            <td class="alignright" width="80%">{% trans "В сумі" %}</td>
                                                                                            <td class="alignright"> {{ price_total }} ₴ </td>
                                                                                        </tr>
                                                                                        
                                                                                    </tbody>
                                                                                </table>
                                                                            </td>
                                                                        </tr>
                                                                        <tr>
                                                                            <td>
                                                                                <div class="input-group d-flex justify-content-center mt-3">
                                                                                    <input type="hidden" id="amount" value="{{ price_total }}">
                                                                                    <input type="email" name="email_input" class= "input-email" id="formGroupExampleInput" placeholder="E-mail" >
                                                                                    <div class="input-group-append">
                                                                                        
                                                                                        <button id="pay_btn" class="btn btn-success " type="submit" onclick="location.href=createOrder('{{ price_total }}')">{% trans 'Забронювати' %} {{ price_total }} UAH</button> 
                                                                                    </div>
                                                                                </div>
                                                                            </td>
                                                                        </tr>
                                                                        
                                                                        <tr>
                                                                            <td class="">
                                                                                <!-- <div id="checkout"></div> -->

                                                                                
                                                                                




                                                                                
                                                                                    
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </td>
                                                        </tr>
                                                        
                                                    </tbody>
                                                </table>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                            </div>
                        </td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            
        
            
          
    
{% endblock  %}

{% block js %}{% get_current_language as LANGUAGE_CODE %}
    <script src="https://api.fondy.eu/static_common/v1/checkout/ipsp.js"></script>
    <!-- <script> // мой создайный лч кошелек
        var button = $ipsp.get('button');
        button.setMerchantId(1449720);
        button.setAmount(`{{ price_total }}`, 'UAH', true);
        button.addParam("lang","{{LANGUAGE_CODE}}");
        button.setResponseUrl('https://cinemaxpro.herokuapp.com/');
        button.setHost('api.fondy.eu');
    </script> -->
    <script> // тестовый кошелек card - 4444555566661111 use - 10/22 cvv - 324
    

    function createOrder(amount){
            
            
            
            var email = $('.input-email').val();
            console.log(email)
            if(email == ''){
                alert('eee');
            }else{
                location.href
                console.log('ss')
                var amount = $('#amount').val()
                var button = $ipsp.get('button');
                button.setMerchantId(1449720);
                button.addParam("lang","{{LANGUAGE_CODE}}");
                button.setAmount(amount, 'UAH', true);
                button.setResponseUrl('https://cinemaxpro.herokuapp.com/get_ticket/{{session.id}}/{{place.id}}/{{price_total}}/'+email); // button.setResponseUrl('http://127.0.0.1:8000/get_ticket/{{session.id}}/{{place.id}}/{{price_total}}/'+email); // button.setResponseUrl('https://cinemaxpro.herokuapp.com/get_ticket/{{session.id}}/{{place.id}}/{{price_total}}/'+email);  //////////// button.setResponseUrl('https://cinemaxpro.herokuapp.com/get_ticket/{{session.id}}/{{place.id}}/{{price_total}}/'+email); //'https://cinemaxpro.herokuapp.com/'
                button.setHost('api.fondy.eu'); 
           
    
                return button.getUrl(); 
            }

            
        
    }
        // var button = $ipsp.get('button');
        
        // button.setMerchantId(1449720);
        // button.setAmount(`{{ price_total }}`, 'UAH', true);
        // button.addParam("lang","{{LANGUAGE_CODE}}");
        // button.setResponseUrl('http://127.0.0.1:8000/'); 
        //button.setResponseUrl('https://cinemaxpro.herokuapp.com/');
        // button.setHost('api.fondy.eu');
        
        
   
    </script> 
   
    {% comment %}
    <!-- <script src="//api.fondy.eu/static_common/v1/checkout/ipsp.js"></script>
    <script>
        var button = $ipsp.get("button");
        button.setHost("api.fondy.eu");
        button.addParam("order_desc","cinemaxpay");
        button.addParam("lang","uk");
        button.setProtocol("https");
        button.setMerchantId(1449632);
        button.setAmount("{{ price_total }}","UAH",true);
        button.setResponseUrl("{response_url}");
        button.addParam("order_desc","квитки на сеанс");
        var url = button.getUrl();
        $ipsp("checkout").config({
            "wrapper": "#checkout",
                "styles": {
                    "body": {
                        "overflow": "hidden"
                    }
                }
        }).scope(function () {
            this.width("100%");
            this.height(480);
            this.action("resize", function (data) {
                this.setCheckoutHeight(data.height);
            })
            this.loadUrl(url);
        });
        </script> -->{% endcomment %}

        <!-- <script> попробовать залить на хостинг
            window.LiqPayCheckoutCallback = function() {
              LiqPayCheckout.init({
                data:"eyJ2ZXJzaW9uIjozLCJhY3Rpb24iOiJwYXkiLCJwdWJsaWNfa2V5IjoiaTcxMTUzNzY2NjAwIiwiYW1vdW50IjoiNSIsImN1cnJlbmN5IjoiVUFIIiwiZGVzY3JpcHRpb24iOiLQnNC+0Lkg0YLQvtCy0LDRgCIsInR5cGUiOiJidXkiLCJsYW5ndWFnZSI6InJ1In0=",
                signature: "T4rPYFS4pHt3Om2L1q1aulWJdNs",
                embedTo: "#liqpay_checkout",
                mode: "embed" // embed || popup,
                 }).on("liqpay.callback", function(data){
                      console.log(data.status);
                      console.log(data);
                      }).on("liqpay.ready", function(data){
                          // ready
                      }).on("liqpay.close", function(data){
                          // close
                  });
            };
          </script>
          <script src="//static.liqpay.ua/libjs/checkout.js" async></script> -->

          <!-- <script>
            liqpay = LiqPay('sandbox_i23530229261', private_key)
            html = liqpay.cnb_form({
                'action': 'pay',
                'amount': '1',
                'currency': 'USD',
                'description': 'description text',
                'order_id': 'order_id_1',
                'version': '3'
            })
        </script> -->
{% endblock %}
